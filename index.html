<!DOCTYPE html>
<html>
<head>
  <title>YouTube VR Player</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body>
  <a-scene>
    <a-assets>
      <video id="video" crossorigin="anonymous" webkit-playsinline></video>
    </a-assets>
    
    <a-entity id="video-entity" geometry="primitive: plane; height: 5; width: 9" material="shader: flat; src: #video" position="0 1.6 -5"></a-entity>

    <a-entity id="left-eye" camera="eye:left" look-controls></a-entity>
    <a-entity id="right-eye" camera="eye:right" look-controls></a-entity>

    <a-entity id="vr-mode-button" position="0 -3 0" text="value: Enter VR Mode; align: center" geometry="primitive: plane; width: 4; height: 0.5" material="shader: flat; color: red" cursor-listener></a-entity>
  </a-scene>

  <script>
    const videoElement = document.querySelector("#video");
    const videoEntity = document.querySelector("#video-entity");
    const vrModeButton = document.querySelector("#vr-mode-button");
    let player;

    AFRAME.registerComponent("cursor-listener", {
      init: function() {
        this.el.addEventListener("click", () => {
          if (AFRAME.utils.device.isMobile()) {
            enterVRMode();
          } else {
            alert("This feature is only supported on mobile devices.");
          }
        });
      },
    });

    function enterVRMode() {
      vrModeButton.setAttribute("visible", "false");
      player.playVideo();
    }

    function loadYouTubeVideo(videoId) {
      player = new YT.Player("video", {
        videoId: videoId,
        playerVars: {
          autoplay: 0,
          controls: 0,
          playsinline: 1,
          rel: 0,
          showinfo: 0,
          iv_load_policy: 3,
        },
        events: {
          onReady: onPlayerReady,
        },
      });
    }

    function onPlayerReady(event) {
      videoEntity.setAttribute("visible", "true");
      videoEntity.setAttribute("position", "0 0 -5");
    }

    const videoUrl = prompt("Enter a YouTube video URL:");
    const videoId = getVideoIdFromUrl(videoUrl);

    if (videoId) {
      loadYouTubeVideo(videoId);
    } else {
      alert("Invalid YouTube video URL.");
    }

    function getVideoIdFromUrl(url) {
      const regex = /^(?:https?:\/\/)?(?:www\.)?youtu(?:\.be|be\.com)\/(?:watch\?v=|embed\/|v\/|\/)([^&?]{11})/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }
  </script>
</body>
</html>

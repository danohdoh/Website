<!DOCTYPE html>
<html>
<head>
  <title>YouTube VR Viewer</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
  <a-scene>
    <a-assets>
      <video id="video" crossorigin="anonymous" webkit-playsinline></video>
    </a-assets>
    
    <a-entity id="video-entity" geometry="primitive: sphere; radius: 10" material="shader: flat; src: #video" position="0 1.6 -10"></a-entity>

    <a-entity id="left-eye" camera="eye:left" look-controls></a-entity>
    <a-entity id="right-eye" camera="eye:right" look-controls></a-entity>

    <a-entity id="vr-mode-button" position="0 -3 0" text="value: Enter VR Mode; align: center" geometry="primitive: plane; width: 4; height: 0.5" material="shader: flat; color: red" cursor-listener></a-entity>
  </a-scene>

  <script>
    const videoElement = document.querySelector("#video");
    const videoEntity = document.querySelector("#video-entity");
    const vrModeButton = document.querySelector("#vr-mode-button");

    AFRAME.registerComponent("cursor-listener", {
      init: function() {
        this.el.addEventListener("click", () => {
          if (AFRAME.utils.device.isMobile()) {
            enterVRMode();
          } else {
            alert("This feature is only supported on mobile devices.");
          }
        });
      },
    });

    function enterVRMode() {
      vrModeButton.setAttribute("visible", "false");
      videoElement.play();
    }

    function loadYouTubeVideo(videoId) {
      const youtubeUrl = `https://www.youtube.com/embed/${videoId}?autoplay=0&controls=0&playsinline=1&rel=0&showinfo=0&iv_load_policy=3`;

      videoElement.setAttribute("src", youtubeUrl);
      videoElement.setAttribute("webkit-playsinline", "true");
      videoElement.load();
    }

    const videoUrl = prompt("Enter a YouTube video URL:");
    const videoId = getVideoIdFromUrl(videoUrl);

    if (videoId) {
      loadYouTubeVideo(videoId);
    } else {
      alert("Invalid YouTube video URL.");
    }

    function getVideoIdFromUrl(url) {
      const regex = /^(?:https?:\/\/)?(?:www\.)?youtu(?:\.be|be\.com)\/(?:watch\?v=|embed\/|v\/|\/)([^&?]{11})/;
      const match = url.match(regex);
      return match ? match[1] : null;
    }
  </script>
</body>
</html>
